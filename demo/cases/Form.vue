<template>
    <article class="veui-form-demo">
        <h1>
            <code>&lt;veui-form&gt;</code>
        </h1>
        <h2>Formå°ºå¯¸</h2>
        <div class="options-desc">
            å¯é€‰çš„å°ºå¯¸ <span class="bg-gray-show">ui</span> 
            å±æ€§å€¼ï¼š <span class="bg-gray-show">s(é»˜è®¤ï¼Œå¯ä¸ä¼ ) / m </span>
        </div>
        <h2>Formé£æ ¼</h2>
        <div class="options-desc">
            å¯é€‰çš„é£æ ¼ <span class="bg-gray-show">ui</span> 
            å±æ€§å€¼ï¼š <span class="bg-gray-show">normal(é»˜è®¤ï¼Œå¯ä¸ä¼ ) / loose / top </span>
        </div>
        <h2>Fieldå°ºå¯¸</h2>
        <div class="options-desc">
            å¯é€‰çš„å°ºå¯¸ <span class="bg-gray-show">ui</span> 
            å±æ€§å€¼ï¼š <span class="bg-gray-show">s(é»˜è®¤ï¼Œå¯ä¸ä¼ ) / m</span>
        </div>
        <h2>Fieldé£æ ¼</h2>
        <div class="options-desc">
            å¯é€‰çš„å°ºå¯¸ <span class="bg-gray-show">ui</span> 
            å±æ€§å€¼ï¼š <span class="bg-gray-show">long / few(é»˜è®¤ï¼Œå¯ä¸ä¼ ) / special</span>
        </div>
        <h2>Fieldå¯¹é½æ–¹å‘</h2>
        <div class="options-desc">
            å¯é€‰çš„å°ºå¯¸ <span class="bg-gray-show">ui</span> 
            å±æ€§å€¼ï¼š <span class="bg-gray-show">left / right(é»˜è®¤ï¼Œå¯ä¸ä¼ ) </span>
        </div>
        <section>
            <h3>Formå°ºå¯¸ï¼šs â• Formé£æ ¼ï¼šnormal</h3>
            <div class="title-desc">Fieldå¯¹é½æ–¹å¼ï¼šright</div>
            <br/>
            <div class="title-desc">Fieldä¸åŒé£æ ¼</div>
            <veui-form
                ref="form1"
                :data="storeData1"
            >
                <veui-field
                    v-for="(item, index) in demoData"
                    :key="`demo1_${index}`"
                    :label="item.label"
                    :ui="item.ui">
                    <veui-input v-model="storeData1.nickName"/>
                </veui-field>
            </veui-form>
            <div class="title-desc">Fieldå¯¹é½æ–¹å¼ï¼šleft</div>
            <br/>
            <div class="title-desc">Fieldä¸åŒé£æ ¼</div>
            <veui-form
                ref="form1"
                :data="storeData1"
            >
                <veui-field
                    v-for="(item, index) in demoData"
                    :key="`demo1_${index}`"
                    :label="item.label"
                    :ui="`${item.ui} left`">
                    <veui-input v-model="storeData1.nickName"/>
                </veui-field>
            </veui-form>
        </section>
        <section>
            <h3>Formå°ºå¯¸ï¼šm â• Formé£æ ¼ï¼šloose</h3>
            <div class="title-desc">Fieldå¯¹é½æ–¹å¼ï¼šright</div>
            <br/>
            <div class="title-desc">Fieldä¸åŒé£æ ¼</div>
            <veui-form
                ui="m loose"
                ref="form1"
                :data="storeData1"
            >
                <veui-field
                    v-for="(item, index) in demoData"
                    :key="`demo2_${index}`"
                    :label="item.label"
                    :ui="item.ui">
                    <veui-input v-model="storeData1.nickName"/>
                </veui-field>
            </veui-form>
        </section>
        <section>
            <h3>Formå°ºå¯¸: s â• Formé£æ ¼: top</h3>
            <veui-form
                ui="s top"
                ref="form1"
                :data="storeData1"
            >
                <veui-field label="çŸ­æ ‡ç­¾">
                    <veui-input v-model="storeData1.nickName"/>
                </veui-field>
                <veui-field label="æ–‡æœ¬å¾ˆé•¿çš„æ ‡ç­¾">
                    <veui-input v-model="storeData1.nickName"/>
                </veui-field>
            </veui-form>
        </section>
        <section>
            <h2>è¡¨å•çš„ç¦ç”¨æˆ–åªè¯»</h2>
            <veui-form
                disabled
                :data="storeData1"
            >
                <veui-field
                    label="æ˜µç§°"
                    field="nickName"
                >
                    <veui-input v-model="storeData1.nickName"/>
                </veui-field>

                <veui-field
                    label="æ€§åˆ«"
                    field="sex"
                >
                    <veui-select
                        v-model="storeData1.sex"
                        :options="storeData1.sexItems"
                    />
                </veui-field>

                <veui-field
                    label="å©šå§»"
                    field="married"
                >
                    <veui-radiogroup
                        v-model="storeData1.married"
                        :items="storeData1.marryItems"
                    />
                </veui-field>

                <veui-field
                    ui="small"
                    label="çˆ±å¥½"
                    field="hobby"
                >
                    <veui-checkboxgroup
                        v-model="storeData1.hobby"
                        ui="small"
                        type="checkbox"
                        :items="storeData1.hobbyItems"
                    />
                </veui-field>

                <veui-field
                    label="ç”Ÿæ—¥"
                    field="birthday"
                >
                    <veui-datepicker v-model="storeData1.birthday"/>
                </veui-field>

                <veui-field
                    label="å¤´åƒ"
                    field="avatar"
                >
                    <veui-uploader
                        v-model="storeData1.avatar"
                        type="image"
                        action="/upload"
                        request-mode="xhr"
                        ui="vertical"
                        :disabled="false"
                        :max-count="1"
                        max-size="10mb"
                        accept=".jpg, .jpeg, .png"
                    />
                </veui-field>
            </veui-form>
        </section>
        <section>
            <h2>ä½¿ç”¨ field æ¥æ”¯æŒè¡¨å•éªŒè¯ï¼Œä½¿ç”¨ name æ¥å®šä½éªŒè¯æç¤º</h2>
            <veui-form
                ui="s"
                ref="form2"
                :readonly="isValidating"
                :data="storeData4"
                :validators="validators"
                :before-validate="beforeValidate"
                :after-validate="afterValidate"
                @submit="submit"
                @invalid="handleInvalid"
            >
                <veui-field
                    disabled
                    field="name"
                    name="name1"
                    label="å§“å"
                    tip="disabled å€¼æäº¤æ—¶ä¼šè¿‡æ»¤"
                >
                    <veui-input v-model="storeData4.name"/>
                </veui-field>

                <veui-field
                    field="name1"
                    name="name2"
                    label="å§“å1"
                    tip="åœ¨ field ä¸Šè¾¹ disabledï¼Œæäº¤æ—¶æ‰ä¼šè¿‡æ»¤æ‰ï¼Œè¯¥é¡¹åœ¨ input ä¸Š disalbed"
                >
                    <veui-input
                        v-model="storeData4.name1"
                        disabled
                        placeholder="é•¿åº¦ä¸èƒ½çŸ­äº2"
                    />
                </veui-field>

                <veui-field
                    field="age"
                    name="age1"
                    :rules="ageRule"
                    label="å¹´é¾„"
                >
                    <veui-input
                        v-model="storeData4.age"
                        placeholder="é”™è¯¯æç¤ºä¼˜å…ˆå‡ºåœ¨å³ä¾§, é•¿åº¦ä¸èƒ½è¶…è¿‡3"
                    />
                </veui-field>

                <veui-field
                    field="desc"
                    name="desc"
                    rules="required"
                    label="ä»‹ç»"
                >
                    <veui-textarea
                        v-model="storeData4.desc"
                        rows="3"
                    />
                </veui-field>

                <veui-fieldset
                    name="phoneSet"
                    label="ç”µè¯"
                    :required="true"
                >
                    <veui-field
                        field="phoneType"
                        name="phoneType"
                    >
                        <veui-select
                            v-model="storeData4.phoneType"
                            :options="storeData4Options.phoneTypeOptions"
                        />
                    </veui-field>

                    <veui-field
                        style="margin-left: 4px;"
                        field="phone"
                        name="phone"
                        :rules="numRequiredRule"
                    >
                        <veui-input v-model="storeData4.phone"/>
                    </veui-field>
                </veui-fieldset>

                <veui-field
                    field="hobby"
                    name="hobby"
                    :rules="hobbyRule"
                    label="çˆ±å¥½"
                    tip="é€‰æ‹©åˆ™è‡³å°‘é€‰ä¸‰ä¸ª"
                >
                    <veui-checkboxgroup
                        v-model="storeData4.hobby"
                        type="checkbox"
                        :items="storeData4Options.hobbyItems"
                    />
                </veui-field>

                <veui-fieldset
                    label="é¢„æœŸæ”¶å…¥"
                    class="salary"
                    tip="è”åˆæ ¡éªŒï¼Œä¸‹é™å¿…é¡»å°äºä¸Šé™"
                    :required="true"
                >
                    <veui-field
                        field="start"
                        name="start"
                        :rules="numRequiredRule"
                        class="start-field"
                    >
                        <veui-input v-model="storeData4.start"/>
                    </veui-field>
                    <veui-span style="margin: 0 4px;">-</veui-span>
                    <veui-field
                        field="end"
                        name="end"
                        :rules="numRequiredRule"
                    >
                        <veui-input v-model="storeData4.end"/>
                    </veui-field>
                    <veui-span>ä¸‡</veui-span>
                </veui-fieldset>

                <veui-field
                    label="æ”¶å…¥ä¸‹é™"
                    field="floor"
                    name="floor"
                    :rules="[
                        { name: 'required', value: true },
                        { name: 'min', value: 3500, message: 'æœ€ä½æ”¶å…¥ä¸å°äº 3500' }
                    ]"
                >
                    <veui-number-input v-model="storeData4.floor"/>
                </veui-field>

                <veui-field
                    field="protocol"
                    name="protocol"
                    :rules="protocolRequiredRule"
                    label="åè®®"
                >
                    <veui-checkbox
                        v-model="storeData4.protocol"
                        false-value
                    >æˆ‘å·²é˜…è¯»å¹¶åŒæ„å·¥ä½œåè®®</veui-checkbox>
                </veui-field>

                <template slot="actions">
                    <veui-button
                        ui="primary"
                        :loading="isValidating"
                        type="submit"
                    >æäº¤</veui-button>
                    <veui-button
                        :disabled="isValidating"
                        @click="() => this.$refs.form2.reset()"
                    >é‡ç½®</veui-button>
                </template>
            </veui-form>
        </section>
        <section>
            <h2>åŠ¨æ€è¡¨å•</h2>
            <veui-form
                ui="m"
                :data="storeData5"
                :validators="qindianValidator"
                :before-validate="beforeValidate"
                :after-validate="afterValidate"
                @submit="submit"
                @invalid="handleInvalid"
            >
                <veui-field
                    ui="few"
                    field="qindian"
                    label="è´Ÿè´£äºº"
                    name="qindian"
                >
                    <veui-input v-model="storeData5.qindian"/>
                </veui-field>

                <veui-fieldset
                    ui="few"
                    v-for="(item, index) in storeData5.scheduleInfo"
                    :key="index"
                    :required="true"
                    :label="`é¡¹ç›®æ’æœŸ-${index + 1}`"
                >
                    <veui-field
                        :field="`scheduleInfo[${index}].project`"
                        :name="'projectName' + (index + 1)"
                        :rules="requiredRule"
                    >
                        <veui-input
                            v-model="item.project"
                            placeholder="é¡¹ç›®åç§°"
                        />
                    </veui-field>
                    <veui-field
                        style="margin-left: 4px;"
                        :field="`scheduleInfo[${index}].range`"
                        :name="`schedule${index + 1}`"
                        :rules="requiredRule"
                    >
                        <veui-datepicker
                            v-model="item.range"
                            range
                        />
                    </veui-field>
                    <veui-button
                        style="margin-left: 4px;"
                        @click="dynamicDelete(index)"
                    >åˆ é™¤</veui-button>
                </veui-fieldset>

                <template #actions>
                    <veui-button
                        ui="primary"
                        :loading="isValidating"
                        type="submit"
                    >æäº¤</veui-button>
                    <veui-button @click="dynamicAdd">æ–°å¢é¡¹ç›®åŠæ’æœŸ</veui-button>
                </template>
            </veui-form>
        </section>
    </article>
</template>

<script>
import {
    Form,
    Fieldset,
    Field,
    Span,
    Input,
    Button,
    DatePicker,
    Uploader,
    Select,
    Textarea,
    Checkbox,
    CheckboxGroup,
    RadioGroup,
    NumberInput
} from 'veui';
import moment from 'moment';
import bus from '../bus';
import 'vue-awesome/icons/indent';

export default {
    name: 'demo-form',

    components: {
        'veui-span': Span,
        'veui-input': Input,
        'veui-number-input': NumberInput,
        'veui-button': Button,
        'veui-form': Form,
        'veui-fieldset': Fieldset,
        'veui-field': Field,
        'veui-datepicker': DatePicker,
        'veui-uploader': Uploader,
        'veui-select': Select,
        'veui-checkbox': Checkbox,
        'veui-checkboxgroup': CheckboxGroup,
        'veui-radiogroup': RadioGroup,
        'veui-textarea': Textarea
    },

    data() {
        let hobby = ['ğŸ¸'];
        let hobbyItems = [
            {
                value: 'âš½ï¸',
                label: 'è¶³çƒ'
            },
            {
                value: 'ğŸ€',
                label: 'ç¯®çƒ'
            },
            {
                value: 'ğŸ¸',
                label: 'ç¾½æ¯›çƒ'
            },
            {
                value: 'ğŸ¾',
                label: 'ç½‘çƒ'
            }
        ];
        let phoneType = 'mobile';
        let phoneTypeOptions = [
            {
                label: 'åº§æœº',
                value: 'phone'
            },
            {
                label: 'æ‰‹æœº',
                value: 'mobile'
            }
        ];
        return {
            demoData: [
                {
                    label: 'ç‰¹æ®Šæƒ…å†µ[ui=special]',
                    ui: 'special'
                },
                {
                    label: 'æ–‡å­—ä¸é•¿[ui=few]',
                    ui: 'few'
                },
                {
                    label: 'å­—æ®µè¾ƒå¤šæ—¶[ui=long]',
                    ui: 'long'
                }
            ],
            storeData1: {
                nickName: 'æäº‘è…¾',
                sex: 'å¥³',
                married: false,
                marryItems: [
                    {
                        value: true,
                        label: 'å·²å©š'
                    },
                    {
                        value: false,
                        label: 'æœªå©š'
                    }
                ],
                sexItems: [
                    {
                        value: '-',
                        label: 'ä¸å‘Šè¯‰ä½ '
                    },
                    {
                        value: 'ç”·',
                        label: 'ç”·'
                    },
                    {
                        value: 'å¥³',
                        label: 'å¥³'
                    }
                ],
                hobby,
                hobbyItems,
                birthday: new Date(),
                avatar: 'https://www.baidu.com/img/bd_logo1.png'
            },
            storeData2: {
                lastName: '',
                firstName: '',
                hobby,
                hobbyItems,
                phone: '18888888888',
                phoneType,
                phoneTypeOptions,
                start: null,
                end: null,
                salary: [2, 5]
            },
            storeData3: {
                statusSelected: 1,
                statusOptions: [
                    {
                        label: 'çŠ¶æ€1',
                        value: 1
                    },
                    {
                        label: 'çŠ¶æ€2',
                        value: 2
                    },
                    {
                        label: 'çŠ¶æ€3',
                        value: 3
                    },
                    {
                        label: 'çŠ¶æ€4',
                        value: 4
                    }
                ],
                range: [
                    moment().toDate(),
                    moment()
                        .add(3, 'month')
                        .toDate()
                ]
            },
            storeData4: {
                name: 'liyunteng1',
                name1: 'liyunteng2',
                age: null,
                desc: '',
                hobby,
                phone: '18888888888',
                phoneType,
                start: null,
                end: null,
                protocol: '',
                floor: 3500
            },
            storeData4Options: {
                hobbyItems,
                phoneTypeOptions
            },
            requiredRule: [
                {
                    name: 'required',
                    value: true,
                    triggers: 'blur,input'
                }
            ],
            numRequiredRule: [
                {
                    name: 'numeric',
                    value: true,
                    triggers: 'blur,input'
                },
                {
                    name: 'required',
                    value: true,
                    triggers: 'blur,input'
                }
            ],
            protocolRequiredRule: [
                {
                    name: 'required',
                    value: true,
                    message: 'è¯·å‹¾é€‰é˜…è¯»åè®®',
                    triggers: 'change'
                }
            ],
            dynamicNameRule: [
                {
                    name: 'required',
                    value: true,
                    triggers: 'blur,input'
                },
                {
                    name: 'minLength',
                    value: 2
                }
            ],
            ageRule: [
                {
                    name: 'required',
                    value: true,
                    triggers: 'input'
                },
                {
                    name: 'numeric',
                    value: true,
                    triggers: 'input'
                },
                {
                    name: 'maxLength',
                    value: 3,
                    triggers: 'change'
                }
            ],
            hobbyRule: [
                {
                    name: 'minLength',
                    value: 3,
                    message: 'è‡³å°‘é€‰æ‹©ä¸‰ä¸ªçˆ±å¥½',
                    triggers: 'change'
                }
            ],
            isValidating: false,
            validators: [
                {
                    fields: ['start', 'end'],
                    handler(start, end) {
                        if (start == null || end == null) {
                            return true;
                        }

                        if (parseInt(start, 10) >= parseInt(end, 10)) {
                            return {
                                start: 'ä¸‹é™å¿…é¡»å°äºä¸Šé™'
                            };
                        }
                        return true;
                    },
                    triggers: ['change', 'submit,input']
                },
                {
                    fields: ['phone'],
                    validate(phone) {
                        return new Promise(function (resolve) {
                            setTimeout(function () {
                                let res;
                                if (phone === '18888888888') {
                                    res = {
                                        phone: 'è¯¥æ‰‹æœºå·²è¢«æ³¨å†Œ'
                                    };
                                }
                                return resolve(res);
                            }, 3000);
                        });
                    },
                    triggers: ['input']
                }
            ],
            beforeValidate() {
                bus.$emit('log', 'beforeValidate');
                this.isValidating = true;
            },
            afterValidate() {
                bus.$emit('log', 'afterValidate');
                this.isValidating = false;
            },
            storeData5: {
                qindian: 'Evan You',
                scheduleInfo: [
                    {
                        project: 'vuejs',
                        range: [
                            moment().toDate(),
                            moment()
                                .add(3, 'month')
                                .toDate()
                        ]
                    }
                ]
            },
            qindianValidator: [
                {
                    // å†—ä½™å†™æ³•ç¤ºèŒƒï¼Œä»…ä»…ä¸ä¼šå‡ºé”™ï¼Œè¯·ä¸è¦è¿™ä¹ˆä½¿ç”¨
                    // å¯ä»¥å°† submit æ¢æˆæ›´æœ‰æ„ä¹‰çš„äº‹ä»¶
                    fields: ['qindian', 'qindian'],
                    handler(qindian) {
                        if (qindian !== 'Evan You') {
                            return {
                                qindian: 'è¯¥é¡¹ä¸ºé’¦ç‚¹é¡¹ï¼Œå°±åˆ«æ”¹äº†'
                            };
                        }
                        return true;
                    },
                    triggers: ['input', 'submit']
                }
            ]
        };
    },

    methods: {
        handleInvalid(e) {
            bus.$emit('log', 'handleInvalid', e);
            this.isValidating = false;
        },
        submit(data, e) {
            bus.$emit('log', 'submit', data, e);
        },
        dynamicAdd() {
            this.storeData5.scheduleInfo.push({
                project: null,
                range: null
            });
        },
        dynamicDelete(index) {
            this.storeData5.scheduleInfo.splice(index, 1);
        }
    }
};
</script>

<style lang="less">
.veui-form-demo {

  section + section {
    margin-top: 50px;
  }

  margin-bottom: 50px;

  .veui-form[ui~="inline"] + .veui-form[ui~="inline"] {
    margin-top: 30px;
  }

  .left {
    float: left;
  }

  .right {
    float: right;
  }

  .output {
    position: absolute;
    display: inline-block;
    left: 560px;
    line-height: 36px;
    margin: 0 0 0 50px;

    &::before {
      position: absolute;
      left: -80px;
      content: "â‡’";
      line-height: 32px;
      font-size: 30px;
      color: #999;
    }
  }

  .two-name {
    .veui-input {
      width: 75px;
    }
  }

  .salary {
    .veui-input {
      width: 67px;
    }
  }

  .start-field {
    .veui-field-error:first-of-type {
      overflow: hidden;
      text-overflow: ellipsis;
      width: 80px;
      white-space: nowrap;
    }
  }

  .operation {
    margin-top: 60px;
    margin-left: 120px;

    [class*="veui"] {
      margin-left: 10px;
    }

    [class*="veui"]:first-child {
      margin-left: 0;
    }
  }
}
</style>
